## 상점 추천(광고) 서비스
* 상점 서비스에 상점을 추천해주는 서비스 입니다.
* 해당 프로젝트의 대표적인 수익 창출 수단입니다.
* 추천 == 광고 라고 생각해도 무방합니다.

## 상세 요구사항
* 추천 서비스에 등록하려면 상점이 등록되어있는 owner 권한의 회원이어야한다.
* 상점 삭제시 추천 서비스는 삭제된다.
* 수익 구조상 환불 불가능 정책이라 회원 탈퇴/상점 삭제시에도 남은 노출횟수만큼 환불되진 않는다.
* 추천시 남은 노출횟수가 0개 초과인 경우만 가지고 와야한다.
* 노출횟수는 노출횟수 전략에 따른다. 아래에 기술되어있다.

## API 설계
```
[POST] /create-recommend : 추천 서비스 등록
[GET] /my-recommend : 나의 서비스 조회
[PUT] /add-impression : 노출횟수 추가, ImpressionRequest 필요
```

## Json body
```
[노출횟수 추가]
{
    "impression" : 1500
}
```

## 서비스간 통신
### username으로 상점 정보 확인
```
url : /shop/username/{username}
request : username
```
### 상점 서비스에 추천하는 상점 id 전달
```
url : [GET] /recommend-shop
```
### 상점삭제/회원 탈퇴시 추천 삭제
```
topic : remove-recommend
request : shopId
```

## 노출횟수 전략
* 추천 서비스에는 impression 이라고하는 광고 노출횟수 데이터가 있다.
* 추천을 한번씩 할때마다 1 씩 감소하는 구조이다.
* 노출횟수는 기본적으로 1000이다.
* 사용자 지정으로 값을 입력하여 지정하는 것도 가능하나,
* 1000 초과의 값이어야만 적용된다.
* 반드시 노출횟수는 1000이상이 되어야한다.
* 1000 이하의 값은 무시하고 1000으로 자동 책정된다.
* 광고 1회 노출당 가격은 5천원이고,
* 기본 광고 등록가격은 1000 * 5000 = 5백만원이다.

## 확률형 광고 모델 알고리즘
### 확률 알고리즘
* db에 등록된 상점들 중에서 남은 노출횟수(impression)가 
* 0 초과인 경우의 데이터들을 count 쿼리를 이용해 수를 뽑아온다.
* 이를 통해서 자바의 Random을 이용해서 1부터 카운트 한 값까지의 수까지 무작위로 하나를 뽑는다.
* 이러한 알고리즘은 algorithm이라는 디렉터리 안의 RecommendAlgorithm 클래스 내부에 기술되어 있다.
### 광고횟수가 0일때
* 만약 노출 횟수를 다채워 0이 되었을때 등록된 상점의 삭제는 굳이 하지 않는다.
* 또한 주인 회원은 나의 광고에서 횟수를 확인할 수 있고, 더결제하여 사용할 수 있다.
### 고민점
* 추천을 할때마다 count 쿼리를 날리는 것은 비효율적이라는 생각이 들 수도 있다.
* 그러나 이것을 해결하려면 캐쉬를 써야한다.
* redis같은 캐쉬를 등록하고 연결해서 사용하는것이 더욱 느리고, 오버 엔지니어링이라 판단되었다.
* 따라서 count쿼리의 성능을 최적화 하는 방법을 선택했다.
* 이것에 대해서는 [count 쿼리 성능 최적화](https://github.com/liveforone/middle/blob/master/Documents/COUNT_QUERY_OPTIMIZATION.md)에서 볼 수 있다.
* 또한 더욱 상세한 추천 알고리즘은 [추천알고리즘](https://github.com/liveforone/middle/blob/master/Documents/RECOMMENDATION_ALGORITHM.md)에서 볼 수 있다.
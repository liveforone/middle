(상점 삭제시 추천서비스 까지 삭제하라곤 안함, 돈받은 것이라서 반드시 끝낸다. 물론 환불 불가능)

임프레션 0개 이상으로 들고와야함

## 기본 구조
* create로 추천에 등록한다.
* add impression api로 노출횟수를 지정하는데,
* 기본값은 1000이다. 사용자가 지정 가능하며, 1000 이하의 값은 자동으로 무시하고 1000으로 책정한다.
* 1000 초과의 값은 사용자가 입력한 대로 지정한다.

상점 추천 서비스에 상점 등록
상점 추천 서비스에 추가 결제
나의 추천 서비스 데이터 리턴

등록시 상점 provide controler로 상점 id 받아오기
상점 서비스에 provide로 뽑은 상점 id리턴

기본적으로 광고는 1000건이 기본 값이다.
cpm = 1000건의 노출
validator로 1000건 이하가 들어오면 그냥 1000건으로 친다.
두번째는 원하는 수만큼 책정
즉 1000건 이상일 경우 사용자가 직접 입력한다.
계좌에 연동하는 시스템은 만들지 않기로 했지만 가격은 책정해야함
1회 노출당 5천원 => cpm = 5백만원
위의 가격으로 책정함

하나의 데이터를 저장하기위해 새로운 테이블을 생성하는 것은 비 효율적이다.
따라서 배치/스케줄러로 특정한 값들을 저장해 시간당으로 업데이트 하고 바로바로 값을 조회하여 비용을 줄이려면 여러개의 값을 넣는것이 효율적이다. 따라서 만들지 않는다.

## 확률형 광고 모델 알고리즘
### 확률 알고리즘
이 서비스의 수익모델은 광고이다.
예약 플랫폼에 올리는 것만으로 광고의 시작이며
추가 결제를 통해 광고 리스트에 노출횟수를 올린다.(광고 노출 구현해보기)
즉 플랫폼에 등록 + 추가 결제(광고를 위한)이 수익 모델이다.
광고 노출 : 가격별로 광고노출횟수(Impressions)를 제한한다(100, 150,,,,1000) -> 100부터 1000까지 50단위로 추가
DB전체 데이터 수를 뽑아서 그 수를 사용해 확률을 지정하여 랜덤으로 값을 뽑아 나온 id를 호출하고
호출 되었다면 노출횟수를 마이너스 해주는 방식으로 하면된다.
랜덤으로 뽑을때는 DB전체 데이터 수를 count해서 그 수안의 값만큼 1부터 그 수까지 랜덤으로 뽑으면된다.
(math.random)
기본적으로 위처럼 count 쿼리로 해결해도 되고,
max 쿼리를 이용해서 맨 마지막 테이블의 id를 가져오는 것으로 해결해도 된다.
### 광고횟수가 0일때
만약 횟수를 다채워 0이 되었을때 삭제는 굳이 하지 않는다.
또한 주인 회원은 나의 광고에서 횟수를 확인할 수 있고, 더결제하여 사용할 수 있다.
당연히 정해친 갯수만큼만 결제가능하다.
### 리턴방법
기본적으로 횟수가 0이상인(< 0)지 쿼리에서 체크한다.
가져온 후에는 어떤 조건이던 가져온 shop리스트의 첫번째 인덱스에 해당 shop의 id를 바탕으로 조회해서 기존의 shop리스트와 합쳐준다.
add(0, 값) : 0은 ZERO_INDEX라는 상수를 활용하기
### 고민점
문제는 둘 중 어느것이 성능이 더욱 좋은지를 판단해봐야한다.(이런것 고민한것 어필하며 적기 + DB와 웹 어플리케이션 성능 높이려 노력한것 어필)

## count 쿼리 성능 최적화
지금은 데이터가 적어서 실감이 안나지만 향후 데이터가 커지면 매번 count쿼리시 자원소모가 너무 심해질것이다.
따라서 테이블을 하나 만들어서 단 하나의 데이터를 저장한다.
그것은 count쿼리로 날린 전체 테이블의 수이고, 이를 저장해 하루 혹은 1시간 마다 배치로 다시 전체 테이블의 수를 업데이트하는(광고를 등록하는 수가 하루에 많지 않을 것이기 때문에 매번 count 쿼리를 날리는게 상당히 부담이 된다.) 방식을 사용하면 count 쿼리를 매번 날릴때와 달리 성능이 어마어마하게 최적화 될것이다.
애초에 데이터를 읽는다는 것이 속도가 더 느리다.
즉 count(컬럼)이 count(*)보다 느리다.


## 쿼리 참조 링크
https://parksay-dev.tistory.com/m/48
https://m.blog.naver.com/birdparang/221574304831
마지막 값